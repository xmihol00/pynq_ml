#ifndef _CNN_H_
#define _CNN_H_

#include <inttypes.h>
#include "ap_axi_sdata.h"
#include "ap_int.h"
#include "hls_stream.h"
#include "stdlib.h"
#ifndef __SYNTHESIS__
	#include <iostream>
#endif

#define STRIPE_HEIGHT 6
#define STRIPE_OUTPUT_HEIGHT ((STRIPE_HEIGHT - 2) / 2)
#define L1_STRIPE_INPUT_WIDTH 512
#define L2_STRIPE_INPUT_WIDTH (L1_STRIPE_INPUT_WIDTH / 2)
#define L3_STRIPE_INPUT_WIDTH (L2_STRIPE_INPUT_WIDTH / 2)
#define AXI_INPUT_WIDTH 64
#define AXI_OUTPUT_WIDTH 128
#define INT8_BITS 8
#define INT16_BITS 16
#define IN_CHANNELS 3
#define L1_KERNELS 4
#define L2_KERNELS 8
#define KERNEL_SIZE 3
#define OUTPUT_BATCH_SIZE 4

typedef ap_axiu<AXI_INPUT_WIDTH, 0, 0, 0> axis_in_t;
typedef ap_axiu<AXI_OUTPUT_WIDTH, 0, 0, 0> axis_out_t;

void cnn(hls::stream<axis_in_t> &in, hls::stream<axis_out_t> &out);

#define KERNEL_WEIGHTS_L1 {\
        {{    6,   14,  -16 }, {    2,    9,    8 }, {   -2,  -13,   -3 }},\
        {{   14,    3,  -11 }, {   -4,   -6,    6 }, {   -9,    2,   15 }},\
        {{   -6,   -6,    9 }, {   -3,  -15,    6 }, {  -15,  -14,   -1 }},\
        {{    7,  -12,    0 }, {   13,   14,  -15 }, {    0,  -16,   -7 }},\
        {{  -12,   -9,   -6 }, {   -1,   11,   -6 }, {    1,   13,    7 }},\
        {{    2,   12,   12 }, {   10,   -1,   -5 }, {   -3,    6,    4 }},\
        {{    0,    8,   -4 }, {    3,  -12,  -11 }, {   -1,    2,   -1 }},\
        {{    7,   -4,    7 }, {  -16,    8,   -9 }, {   -8,    6,    1 }},\
        {{   -2,  -12,   -9 }, {   -9,   -6,   -9 }, {  -16,   15,    3 }},\
        {{  -15,   -7,   -8 }, {    3,   -4,    9 }, {   -2,   -4,  -15 }},\
        {{   -6,    2,   13 }, {    0,  -14,   11 }, {  -15,   -9,   14 }},\
        {{   12,  -11,  -16 }, {    4,   12,   13 }, {    8,  -10,   -4 }}\
    }

#define KERNEL_WEIGHTS_L2 {\
        {{  -13,  -14,  -11 }, {   14,    9,    9 }, {  -13,   -2,    3 }},\
        {{   11,   -3,    2 }, {  -15,    9,  -16 }, {  -10,    9,  -11 }},\
        {{   -5,    9,    9 }, {   -6,  -14,    4 }, {   -5,   -6,   15 }},\
        {{    2,  -15,  -15 }, {   -1,   11,    1 }, {    9,    2,  -16 }},\
        {{    1,   14,   14 }, {   -8,   -4,    1 }, {   -6,   -1,    4 }},\
        {{   14,  -15,   -7 }, {   14,   -1,  -11 }, {   11,    6,    1 }},\
        {{   -4,   -1,    9 }, {    6,   -7,   11 }, {  -15,  -16,   -2 }},\
        {{  -11,    0,    0 }, {   -3,  -13,   11 }, {   -2,   13,  -16 }},\
        {{   10,   13,    1 }, {   -6,  -12,  -11 }, {   11,    7,  -11 }},\
        {{  -10,   -5,   -7 }, {   -2,   -7,    0 }, {   -2,    2,   -9 }},\
        {{   14,  -16,   15 }, {  -11,    0,   -4 }, {   14,    3,  -11 }},\
        {{   -1,    1,   -2 }, {    2,   12,   -7 }, {    1,  -15,   11 }},\
        {{  -11,    6,  -12 }, {  -11,  -14,   15 }, {  -14,  -15,   14 }},\
        {{   -8,  -15,   12 }, {   13,  -11,   13 }, {    1,   -4,  -15 }},\
        {{    2,    2,   14 }, {    3,    7,   -5 }, {    7,   -1,   12 }},\
        {{  -16,    8,   13 }, {  -14,  -13,   -7 }, {    9,   -5,   11 }},\
        {{    0,   -6,    8 }, {   -7,   -1,  -12 }, {    1,    2,    7 }},\
        {{   -2,    0,    6 }, {  -13,   -9,   -7 }, {   -1,  -15,   -8 }},\
        {{    3,    7,    6 }, {    8,   -6,   -3 }, {   15,   -9,   -5 }},\
        {{   -2,  -11,   -3 }, {    0,    1,    7 }, {  -10,   14,  -14 }},\
        {{    1,    4,  -13 }, {   15,    6,   13 }, {  -16,   -6,   -8 }},\
        {{   -4,   -6,   13 }, {    5,  -14,  -13 }, {   -7,    1,  -14 }},\
        {{   -2,   -6,  -10 }, {    2,   -6,    2 }, {  -10,   -9,    5 }},\
        {{   -5,  -11,    9 }, {  -15,  -13,   10 }, {    3,  -10,   10 }},\
        {{   11,   10,    2 }, {  -15,    8,    7 }, {   -3,  -12,   10 }},\
        {{   -7,    6,   -4 }, {    1,   14,   15 }, {   -1,    0,  -11 }},\
        {{    6,    6,  -14 }, {    3,    7,  -12 }, {  -15,   10,   -2 }},\
        {{    8,   -2,   11 }, {    5,   -6,    1 }, {   -5,  -13,  -13 }},\
        {{    4,  -12,   -6 }, {    8,   13,    5 }, {    0,   10,  -15 }},\
        {{   11,   10,  -15 }, {    7,   -9,    5 }, {  -12,  -15,    2 }},\
        {{  -11,   -3,   -9 }, {  -15,  -16,    6 }, {   -9,   12,   12 }},\
        {{  -14,    9,  -12 }, {    3,   -9,  -13 }, {   10,   -2,   -8 }}\
    }

#endif