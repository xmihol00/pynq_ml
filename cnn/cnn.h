#ifndef _CNN_H_
#define _CNN_H_

#include <inttypes.h>
#include "ap_axi_sdata.h"
#include "ap_int.h"
#include "hls_stream.h"
#include "stdlib.h"
#ifndef __SYNTHESIS__
	#include <iostream>
#endif

#define STRIPE_HEIGHT 6
#define STRIPE_OUTPUT_HEIGHT ((STRIPE_HEIGHT - 2) / 2)
#define L1_STRIPE_INPUT_WIDTH 512
#define L2_STRIPE_INPUT_WIDTH (L1_STRIPE_INPUT_WIDTH / 2)
#define L3_STRIPE_INPUT_WIDTH (L2_STRIPE_INPUT_WIDTH / 2)
#define AXI_INPUT_WIDTH 64
#define AXI_OUTPUT_WIDTH 128
#define INT8_BITS 8
#define INT16_BITS 16
#define IN_CHANNELS 3
#define L1_KERNELS 4
#define L2_KERNELS 8
#define KERNEL_SIZE 3
#define OUTPUT_BATCH_SIZE 4

typedef ap_axiu<AXI_INPUT_WIDTH, 0, 0, 0> axis_in_t;
typedef ap_axiu<AXI_OUTPUT_WIDTH, 0, 0, 0> axis_out_t;

void cnn(hls::stream<axis_in_t> &in, hls::stream<axis_out_t> &out);

#define KERNEL_WEIGHTS_L1 {\
        {{    6,   14,  -16 }, {    2,    9,    8 }, {   -2,  -13,   -3 }},\
        {{   14,    3,  -11 }, {   -4,   -6,    6 }, {   -9,    2,   15 }},\
        {{   -6,   -6,    9 }, {   -3,  -15,    6 }, {  -15,  -14,   -1 }},\
        {{    7,  -12,    0 }, {   13,   14,  -15 }, {    0,  -16,   -7 }},\
        {{  -12,   -9,   -6 }, {   -1,   11,   -6 }, {    1,   13,    7 }},\
        {{    2,   12,   12 }, {   10,   -1,   -5 }, {   -3,    6,    4 }},\
        {{    0,    8,   -4 }, {    3,  -12,  -11 }, {   -1,    2,   -1 }},\
        {{    7,   -4,    7 }, {  -16,    8,   -9 }, {   -8,    6,    1 }},\
        {{   -2,  -12,   -9 }, {   -9,   -6,   -9 }, {  -16,   15,    3 }},\
        {{  -15,   -7,   -8 }, {    3,   -4,    9 }, {   -2,   -4,  -15 }},\
        {{   -6,    2,   13 }, {    0,  -14,   11 }, {  -15,   -9,   14 }},\
        {{   12,  -11,  -16 }, {    4,   12,   13 }, {    8,  -10,   -4 }}\
    }

#define KERNEL_WEIGHTS_L2 {\
        {{  -13,   11,   -5 }, {    2,    1,   14 }, {   -4,  -11,   10 }},\
        {{  -10,   14,   -1 }, {  -11,   -8,    2 }, {  -16,    0,   -2 }},\
        {{    3,   -2,    1 }, {   -4,   -2,   -5 }, {   11,   -7,    6 }},\
        {{    8,    4,   11 }, {  -11,  -14,  -14 }, {   -3,    9,  -15 }},\
        {{   14,  -15,   -1 }, {    0,   13,   -5 }, {  -16,    1,    6 }},\
        {{  -15,    2,    8 }, {   -6,    0,    7 }, {  -11,    4,   -6 }},\
        {{   -6,  -11,   10 }, {    6,    6,   -2 }, {  -12,   10,   -3 }},\
        {{    9,  -11,    2 }, {    9,  -15,   14 }, {   -7,    9,    0 }},\
        {{    1,   -7,   15 }, {   -2,  -12,   12 }, {   14,   13,    8 }},\
        {{    6,    6,   -3 }, {  -13,   13,  -10 }, {    9,    2,   -4 }},\
        {{  -14,   11,   -6 }, {  -15,   -9,  -12 }, {   14,  -15,   -6 }},\
        {{   -1,   -8,   14 }, {    6,   -3,   -6 }, {   -2,  -11,    2 }},\
        {{  -11,   13,    3 }, {  -14,   -7,  -13 }, {    8,    0,   15 }},\
        {{    5,    2,  -15 }, {  -15,    1,    3 }, {    5,    8,    7 }},\
        {{  -15,    3,    9 }, {    9,  -14,   11 }, {   -4,   -1,   -7 }},\
        {{  -13,  -12,   -7 }, {    0,   12,  -14 }, {  -11,    7,  -13 }},\
        {{   -1,   -9,   -6 }, {    1,    6,  -14 }, {   -6,  -13,    8 }},\
        {{   14,    7,   -6 }, {   13,   -9,  -16 }, {   -9,    9,  -16 }},\
        {{    4,    1,    1 }, {  -11,   11,   11 }, {  -11,    0,   -4 }},\
        {{   -7,   15,   13 }, {   -5,   -7,  -12 }, {   -7,   -3,    7 }},\
        {{   13,  -13,    2 }, {   10,    7,   15 }, {  -12,    1,    5 }},\
        {{    5,    6,  -13 }, {  -13,  -10,   -5 }, {    9,   -6,   11 }},\
        {{  -15,   -2,   11 }, {   -2,   14,    1 }, {  -14,    1,    7 }},\
        {{    9,    1,   -1 }, {   15,  -10,  -16 }, {   -7,  -10,    3 }},\
        {{   -3,   -1,  -15 }, {   -5,    0,  -12 }, {   -9,   10,   -2 }},\
        {{    9,   -6,    2 }, {   -1,    6,  -16 }, {   13,    7,    2 }},\
        {{    3,  -15,  -15 }, {   -4,   -1,   -5 }, {    2,  -15,   -9 }},\
        {{   14,   -6,    1 }, {   -9,  -10,  -12 }, {    0,   10,  -13 }},\
        {{   10,  -15,   12 }, {   -2,    3,  -11 }, {   15,  -16,    4 }},\
        {{    1,   -2,  -16 }, {  -11,   -9,  -11 }, {   11,   14,  -15 }},\
        {{   12,   11,    7 }, {   -8,   -5,  -14 }, {   -8,  -14,    5 }},\
        {{   10,   10,  -11 }, {   -2,  -13,  -15 }, {    2,   12,   -8 }}\
    }

#endif